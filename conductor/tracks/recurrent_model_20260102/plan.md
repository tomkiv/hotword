# Plan: Recurrent Model Support (GRU/LSTM)\n\n## Phase 1: Bug Fixes and Trainer Update\n- [~] Task: Update `Trainer` for copied parameters\n  - [ ] Modify `Trainer.TrainStep` to call `SetParams` after `SGDUpdate`\n  - [ ] Write a regression test using a mock layer that returns copies of its weights\n- [ ] Task: Conductor - User Manual Verification 'Phase 1: Bug Fixes and Trainer Update' (Protocol in workflow.md)\n\n## Phase 2: LSTM Implementation\n- [ ] Task: Implement `LSTMLayer` in `pkg/model/lstm.go`\n  - [ ] Define `LSTMLayer` struct and constructor\n  - [ ] Implement `Forward` pass (standard 4-gate LSTM)\n  - [ ] Implement `Backward` pass (BPTT)\n  - [ ] Write unit tests for `LSTMLayer` forward and backward passes\n- [ ] Task: Conductor - User Manual Verification 'Phase 2: LSTM Implementation' (Protocol in workflow.md)\n\n## Phase 3: Integration and Persistence\n- [ ] Task: Update model builder and persistence\n  - [ ] Add `lstm` support to `BuildModelFromConfig`\n  - [ ] Add `lstm` support to `SaveModel` and `LoadModel` (Version 2 format)\n  - [ ] Write tests for saving/loading LSTM models\n- [ ] Task: Conductor - User Manual Verification 'Phase 3: Integration and Persistence' (Protocol in workflow.md)\n\n## Phase 4: Stateful Inference Engine\n- [ ] Task: Implement stateful recurrent inference\n  - [ ] Update `model.Model` and `Layer` interfaces to support stateful operations (optional or via type assertion)\n  - [ ] Update `Engine` to maintain and pass hidden states for recurrent layers\n  - [ ] Verify stateful detection with a real-time hotword test\n- [ ] Task: Conductor - User Manual Verification 'Phase 4: Stateful Inference Engine' (Protocol in workflow.md)
